console.log("EV2D version 0.2.0 by Joshua Ogunlade Oluwanifemi");class Joystick{constructor(t={}){this.container=t.container||document.body,this.size=t.size||150,this.baseColor=t.baseColor||"rgba(0,0,0,0.3)",this.stickColor=t.stickColor||"rgba(0,0,0,0.6)",this.zIndex=t.zIndex||20,this.position=t.position||"absolute",this.left=void 0!==t.left?t.left:20,this.top=void 0!==t.top?t.top:20,this.canvas=document.createElement("canvas"),this._=this.canvas;const e=window.devicePixelRatio||1;this.canvas.width=this.size*e,this.canvas.height=this.size*e,this.canvas.style.width=this.size+"px",this.canvas.style.height=this.size+"px",this.canvas.style.position=this.position,this.canvas.style.zIndex=this.zIndex,this.canvas.style.touchAction="none",this.canvas.style.userSelect="none",this.ctx=this.canvas.getContext("2d"),this.ctx.scale(e,e),this.container.appendChild(this.canvas),this.center=this.size/2,this.maxRadius=.9*this.center,this.stickRadius=.4*this.maxRadius,this.stickX=this.center,this.stickY=this.center,this.active=!1,this.pointerId=null,this.deltaX=0,this.deltaY=0,this._startHandler=this._start.bind(this),this._moveHandler=this._move.bind(this),this._endHandler=this._end.bind(this),this.canvas.addEventListener("pointerdown",this._startHandler),window.addEventListener("pointermove",this._moveHandler),window.addEventListener("pointerup",this._endHandler),window.addEventListener("pointercancel",this._endHandler),this.draw()}_start(t){this.active||"touch"!==t.pointerType&&"pen"!==t.pointerType&&"mouse"!==t.pointerType||(this.active=!0,this.pointerId=t.pointerId,this._updateStickPosition(t))}positionLT(t,e){this._.style.left=t,this._.style.top=e}positionLB(t,e){this._.style.left=t,this._.style.bottom=e}positionRB(t,e){this._.style.right=t,this._.style.bottom=e}positionRT(t,e){this._.style.right=t,this._.style.top=e}size(t,e){this._.style.width=t,this._.style.height=e}scale(t,e){this._.style.padding=t+" "+e}attr(t,e){this._.style.setProperty(t,e)}_move(t){this.active&&t.pointerId===this.pointerId&&this._updateStickPosition(t)}_end(t){this.active&&t.pointerId===this.pointerId&&(this.active=!1,this.pointerId=null,this.stickX=this.center,this.stickY=this.center,this.deltaX=0,this.deltaY=0,this.draw())}_updateStickPosition(t){const e=this.canvas.getBoundingClientRect();let i=t.clientX-e.left,s=t.clientY-e.top,o=i-this.center,n=s-this.center,h=Math.sqrt(o*o+n*n);h>this.maxRadius&&(o=o/h*this.maxRadius,n=n/h*this.maxRadius),this.stickX=this.center+o,this.stickY=this.center+n,this.deltaX=o/this.maxRadius,this.deltaY=n/this.maxRadius,this.draw()}draw(){const t=this.ctx;t.clearRect(0,0,this.size,this.size),t.beginPath(),t.arc(this.center,this.center,this.maxRadius,0,2*Math.PI),t.fillStyle=this.baseColor,t.fill(),t.beginPath(),t.arc(this.stickX,this.stickY,this.stickRadius,0,2*Math.PI),t.fillStyle=this.stickColor,t.fill()}getPosition(){return{x:this.deltaX,y:this.deltaY}}destroy(){this.canvas.removeEventListener("pointerdown",this._startHandler),window.removeEventListener("pointermove",this._moveHandler),window.removeEventListener("pointerup",this._endHandler),window.removeEventListener("pointercancel",this._endHandler),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}function toImage(t){return Image(t)}const CALLS=[];function MAINLOOP(){CALLS.forEach((t=>{t()})),requestAnimationFrame(MAINLOOP)}function getRandomInt(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function toRad(t){return t*Math.PI/180}requestAnimationFrame(MAINLOOP),GUIUPDATE=[];class Vector{constructor(t=0,e=0){this._=[t,e]}add(t){return this._[0]+=t._[0],this._[1]+=t._[1],this}subtract(t){return this._[0]-=t._[0],this._[1]-=t._[1],this}multiply(t){return this._[0]*=t._[0],this._[1]*=t._[1],this}divide(t){return this._[0]/=t._[0],this._[1]/=t._[1],this}scale(t){return this._[0]*=t,this._[1]*=t,this}fill(t){return this._[0]=t,this._[1]=t,this}negate(){return this._[0]*=-1,this._[1]*=-1,this}rotate(t){let e=this._[0],i=this._[1];const s=t,o=Math.cos(s),n=Math.sin(s);return this._[0]=e*o-i*n,this._[1]=e*n+i*o,this}normalize(){let t=Math.sqrt(this._[0]**2+this._[1]**2);return 0===t||(this._[0]/=t,this._[1]/=t),this}get x(){return this._[0]}get y(){return this._[1]}set x(t){this._[0]=t}set y(t){this._[1]=t}}class OOBCollider{constructor(t){let e=t.position,i=t.width,s=t.height,o=t.rotation;this.center=e,this.halfWidth=i/2,this.halfHeight=s/2,this.rotation=o,this.yE=0,this.xE=0,this.cE=vec2(0,0)}getPoints(){const t=Math.cos(this.rotation),e=Math.sin(this.rotation);return[{x:-this.halfWidth,y:-this.halfHeight},{x:this.halfWidth,y:-this.halfHeight},{x:this.halfWidth,y:this.halfHeight},{x:-this.halfWidth,y:this.halfHeight}].map((({x:i,y:s})=>({x:this.center.x+i*t-s*e,y:this.center.y+i*e+s*t})))}update(t){this.center=new Vector(t.width/2,t.height/2).add(t.position),this.rotation=t.rotation,this.halfWidth=t.width/2,this.halfHeight=t.height/2}}function perpendicular(t){return{x:-t.y,y:t.x}}function project(t,e){let i=dot(t[0],e),s=i;for(let o=1;o<t.length;o++){const n=dot(t[o],e);n<i&&(i=n),n>s&&(s=n)}return{min:i,max:s}}function overlap(t,e){return t.max>=e.min&&e.max>=t.min}function getAxes(t){const e=[];for(let i=0;i<t.length;i++){const s=t[i],o=t[(i+1)%t.length],n=subtract(o,s),h=normalize(perpendicular(n));e.push(h)}return e}function isColliding(t,e){const i=t.getPoints(),s=e.getPoints(),o=getAxes(i),n=getAxes(s),h=o.concat(n);for(const t of h){if(!overlap(project(i,t),project(s,t)))return!1}return!0}class Texture{constructor(t="",e=1){this.name="texture",this.image=new Image,this.image.src=t,this.settings={alpha:e},""==t&&this.fillWithColor("black")}fillWithColor(t,e=100,i=100){let s=document.createElement("canvas");s.width=e,s.height=i;let o=s.getContext("2d");o.globalAlpha=this.settings.alpha,o.fillStyle=t,o.fillRect(0,0,s.width,s.height),this.image.src=s.toDataURL("image/png"),s=null}fillWithText(t="default",e=100,i=50,s="blue",o="20px Tahoma"){let n=document.createElement("canvas");n.width=e,n.height=i;let h=n.getContext("2d");h.globalAlpha=this.settings.alpha,h.fillStyle=s,h.alignment="center",h.font=o;let a=h.measureText(t);h.fillText(t,e/2-a.width/2,i/2),this.image.src=n.toDataURL("image/png"),a=null,n=null}fillCustom(t){let e=document.createElement("canvas");e.width=100,e.height=100;let i=e.getContext("2d");i.globalAlpha=this.settings.alpha,t(i,e),this.image.src=e.toDataURL("image/png"),e=null,i=null}resize(t,e){let i=document.createElement("canvas");i.width=t,i.height=e;let s=i.getContext("2d");s.globalAlpha=this.settings.alpha,s.drawImage(this.image,0,0,i.width,i.height),this.image.src=i.toDataURL("image/png"),i=null,s=null}crop(t,e,i,s){let o=document.createElement("canvas");o.width=i,o.height=s;let n=o.getContext("2d");n.globalAlpha=this.settings.alpha,n.drawImage(this.image,t,e,i,s,t,e,i,s),this.image.src=o.toDataURL("image/png"),o=null,n=null}onReady(t){this.image.onload=e=>t(this,e)}getImage(){return this.image}changeURL(t){this.image.src=t}getURL(){return this.image.src}}class ImageAnimator{constructor(t,e=[],i=1300,s=!1,o=!1){o&&console.warn("use ImageSrcAnimation for better result as this is not suitable for speed but is for efficiency"),this.entity=t,this.frames=e,this.key=0,this.step=1,this.fps=i,this.loop=s,this.isPaused=!0,this.isFinished=!1,this.registeredKeys=e}shouldLoop(t){this.loop=t}setDuration(t){this.fps=t}work(){this.isFinished||this.isPaused||(this.registeredKeys.forEach((t=>{Number(this.key)==Number(t[0])&&(this.entity.texture.image=t[1])})),this.key+=1,this.key>this.fps&&(this.loop?this.key=0:this.isFinished=!0))}add(t=1,e){this.registeredKeys.push([t,e])}addAll(t){t.forEach((t=>{this.registeredKeys.push(t)}))}clearKey(t=1){this.registeredKeys.forEach(((e,i)=>{Number(e[0])==Number(t)&&this.registeredKeys.splice(i,1)}))}clear(){this.registeredKeys=[]}start(){this.isPaused=!1}stop(){this.isPaused=!0}reset(){this.key=0,this.isFinished=!1}}class ImageSrcAnimator extends ImageAnimator{constructor(t,e=[],i=1300,s=!1){super(t,e,i,s)}work(){this.isFinished||this.isPaused||(this.registeredKeys.forEach((t=>{Number(this.key)==Number(t[0])&&(this.entity.texture.image.src=t[1])})),this.key+=1,this.key>this.fps&&(this.loop?this.key=0:this.isFinished=!0))}}class FunctionAnimator extends ImageAnimator{constructor(t,e=[],i=1300,s=!1){super(t,e,i,s)}work(){this.isFinished||this.isPaused||(this.registeredKeys.forEach((t=>{Number(this.key)==Number(t[0])&&t[1](this.entity)})),this.key+=1,this.key>this.fps&&(this.loop?this.key=0:this.isFinished=!0))}}class Base{constructor(){this.name="base",this.velocity=new Vector(0,0),this.position=new Vector(0,0),this.mass=1,this.animators={image:new ImageAnimator(this)},this.rotation=0,this.texture=new Texture,this.moveWith=new Vector,this.data={},this.texture.fillWithColor("red"),this.collider=new OOBCollider(this),this.colliderList=[],this.collideLevel=0,this.settings={alpha:1,hasTexture:!0,hasOutline:!1,outlineColor:"black",isVisible:!0,isPaused:!1,rotationType:"position",parentFollow:"all",applyVelocity:!0,velocityReduction:.1,velocitySensitivity:.2,allowMoveWith:!0,rigidResult:!0,rigidElastic:!1,rigidElasticity:1},this.parent=null}beforeRender(t,e,i){}startAllAnimations(){Object.values(this.animators).forEach((t=>{t.start()}))}stopAllAnimations(){Object.values(this.animators).forEach((t=>{t.stop()}))}resetAllAnimations(){Object.values(this.animators).forEach((t=>{t.reset()}))}collideWith(t){return isColliding(this.collider,t.collider)}setMoveWith(t){this.moveWith=t}clearMoveWith(){this.moveWith=new Vector}getDirection(t){let e={north:-Math.PI/2,east:0,south:Math.PI/2,west:Math.PI}[t.toLowerCase()];void 0===e&&(e=-Math.PI/2);let i=e+this.rotation;const s=Math.cos(i),o=Math.sin(i);return new Vector(s,o).normalize()}get width(){return this.texture.image.width}get height(){return this.texture.image.height}set width(t){this.texture.resize(t,this.texture.image.height)}set height(t){this.texture.resize(this.texture.image.width,t)}lookAt(t,e=0){let i=new Vector;i.subtract(this.position),i.add(t.position),this.rotation=Math.atan2(i.y,i.x)+e}checkBeforeForce(){return!0}applyForce(t){this.checkBeforeForce()&&this.velocity.add(t)}onCollide(t,e){}draw(t){if(this.colliderList.forEach(((t,e)=>{t.collideWith(this)&&this.onCollide(t,e)})),this.settings.allowMoveWith&&this.position.add(this.moveWith),this.settings.applyVelocity&&(this.position.add(this.velocity),this.velocity.x>this.settings.velocitySensitivity&&(this.velocity.x-=this.settings.velocityReduction),this.velocity.x<-1*this.settings.velocitySensitivity&&(this.velocity.x+=this.settings.velocityReduction),this.velocity.y>this.settings.velocitySensitivity&&(this.velocity.y-=this.settings.velocityReduction),this.velocity.y<-1*this.settings.velocitySensitivity&&(this.velocity.y+=this.settings.velocityReduction),this.velocity.x<this.settings.velocitySensitivity&&this.velocity.x>-1*this.settings.velocitySensitivity&&(this.velocity.x=0),this.velocity.y<this.settings.velocitySensitivity&&this.velocity.y>-1*this.settings.velocitySensitivity&&(this.velocity.y=0)),this.settings.isVisible){t.save(),this.collider.update(this);let e=new Vector,i=new Vector;"center"==this.settings.rotationType&&(e=new Vector(this.width/2,this.height/2),i=new Vector(this.width/2,this.height/2),i.negate()),this.parent?("all"==this.settings.parentFollow||"position"==this.parentFollow?t.translate(this.position.x+this.parent.position.x,this.position.y+this.parent.position.y):t.translate(this.position.x,this.position.y),"all"==this.settings.parentFollow||"position"==this.parentFollow?t.rotate(this.parent.rotation+this.rotation):t.rotate(this.rotation)):(t.translate(this.position.x,this.position.y),t.rotate(this.rotation)),t.globalAlpha=this.settings.alpha;const s=this.texture.getImage();this.settings.hasTexture&&t.drawImage(s,i.x,i.y),this.settings.hasOutline&&(t.strokeStyle=this.settings.outlineColor,t.strokeRect(i.x,i.y,s.width,s.height)),t.restore()}}}class ParticleSystem extends Base{constructor(t=new Vector,e=new Vector(200,200),i=5,s=100,o="blue",n=1){super(),this.position=t,this.size=i,this.boundingBox=e,this.count=s,this.texture=new Texture,this.color=o,this.alpha=n,this.settings={updateWhen:"manual",hasOutline:!1,outlineColor:"blue"},this.redraw()}redraw(){let t=document.createElement("canvas");t.width=this.boundingBox.x,t.height=this.boundingBox.y;let e=t.getContext("2d");for(let t=0;t<this.count;t++)e.globalAlpha=this.alpha,e.fillStyle=this.color,e.fillRect(getRandomInt(0,this.boundingBox.x),getRandomInt(0,this.boundingBox.y),this.size,this.size);this.texture.changeURL(t.toDataURL("image/png"))}beforeRender(){}draw(t){t.drawImage(this.texture.getImage(),this.position.x,this.position.y),this.settings.hasOutline&&(t.strokeStyle=this.settings.outlineColor,t.strokeRect(this.position.x,this.position.y,this.texture.image.width,this.texture.image.height))}}class EV2DEngine{constructor(t=document.body,e={}){this.parent=t,this.fps=0,this.currentFrame=0,this.time=0,this.fpsDisplay=document.createElement("h2"),this.fpsDisplay.textContent="0",this.fpsDisplay.style.color="lightgreen",this.fpsDisplay.style.position="fixed",this.fpsDisplay.style.top="0",this.fpsDisplay.style.right="0",document.body.appendChild(this.fpsDisplay),this.lastFrame=performance.now(),this.canvas=document.createElement("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.ctx=this.canvas.getContext("2d"),this.parent.appendChild(this.canvas),this.settings=e,this.entities=[],this.isPaused=!1,this.showFPS=!0,this.updateFps=!0,this.deltaTime=16.67,this.draw=this.render,this.data={},document.querySelector("body").style.overflow="none",window.addEventListener("resize",(()=>{window.matchMedia("(orientation: landscape)").matches?this.onResize("landscape"):this.onResize("portrait"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}))}orientation(){return window.matchMedia("(orientation: landscape)").matches?"landscape":"portrait"}register(t){CALLS.push(t)}clearRegister(){CALLS.clear()}startProcess(t,e=2){t.run(e)}reload(){window.location.reload()}add(t){this.entities.push(t)}reset(){this.entities=[]}beforeRender(t){}render(){this.time+=1,this.updateFps&&(this.showFPS?this.fpsDisplay.style.display="block":this.fpsDisplay.style.display="none",this.fpsDisplay.textContent=this.fps),this.currentFrame=performance.now(),this.deltaTime=this.currentFrame-this.lastFrame,this.fps=(100-this.deltaTime).toFixed(1),this.fps<0&&(this.fps=getRandomInt(1,10)),this.lastFrame=this.currentFrame,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.isPaused||this.beforeRender(this,this.time,this.deltaTime),this.entities.forEach((t=>{this.isPaused||t.isPaused||(t.beforeRender(t,this.time,this.deltaTime),Object.values(t.animators).forEach((t=>{t.work()}))),t.draw(this.ctx)}))}mainloop(){this.render(),requestAnimationFrame((t=>this.mainloop(t)))}onResize(t){}get entityCount(){return this.entities.lenght}lockOrientation(t){screen.orientation&&screen.orientation.lock?screen.orientation.lock(t).then((()=>{console.log(`Orientation locked to ${t}`)})).catch((t=>{console.error("Orientation lock failed:",t)})):console.warn("Screen Orientation API not supported on this browser.")}optimizeCanvasSize(){let t=document.createElement("style");t.textContent="\n    *{\n    margin:0;\n    padding:0;\n    }\n    ",document.head.appendChild(t)}optimizeCanvasDraw(){let t=document.createElement("style");t.textContent="\n    *{\n    image-rendering: pixelated;\n    }\n    ",document.head.appendChild(t)}disableScroll(){let t=document.createElement("style");t.textContent="\n    body{\n    overflow:hidden;\n    }\n    ",document.head.appendChild(t)}optimize(){this.optimizeCanvasSize(),this.disableScroll()}get width(){return game.canvas.width}get height(){return game.canvas.height}setBackground(t){this.canvas.style.background=t}setBackgroundTexture(t){this.canvas.style.background=`url(${t.getImage().src})`}fps(){return window.performance.now()}}function smoothVolumeTransition(t,e,i){audio=t._;const s=i/30,o=(e-audio.volume)/30;let n=0;const h=setInterval((()=>{if(n>=30)return clearInterval(h),void(audio.volume=e);audio.volume+=o,n++}),s)}class Sound{constructor(t,e=!1){this._=new Audio(t),e&&this.play()}set time(t){this._.currentTime=t}play(){this._.play()}pause(){this._.pause()}get time(){return this._.currentTime}set volume(t){this._.volume=t}get volume(){return this._.volume}callOnLoad(t){this._.addEventListener("loadedmetadata",t)}get duration(){return this._.duration}set preload(t="metadate"){this._.preload=t}get ended(){return this._.ended}set loop(t){this._.loop=t}get loop(){return this._.loop}callOnEnd(t){this._.addEventListener("ended",t)}callOnPlay(t){this._.addEventListener("play",t)}callOnTimeUpdate(t){this._.addEventListener("timeupdate",t)}callOnPause(t){this._.addEventListener("pause",t)}}class GUI{constructor(t=[],e="button"){this._=document.createElement(e),this._.style.position="fixed",this._.style.bottom="30px",this._.style.right="20px",this._.style.padding="15px",this._.style.userSelect="none",this._.style.zIndex="100",this._.style.webkitUserSelect="none",this._.style.mozUserSelect="none",this._.style.msUserSelect="none",t.forEach((t=>{this._.style.setProperty(t[0],t[1])})),this._.textContent="",this._.onclick=t=>this.onClick(t),this.buttonDown=!1,document.body.appendChild(this._),this._.ontouchstart=t=>{this.onTouchDown(t),this.buttonDown=!0},this._.onmousedown=t=>{this.onTouchDown(t),this.buttonDown=!0},this._.ontouchend=t=>{this.onTouchUp(t),this.buttonDown=!1},this._.onmouseup=t=>{this.onTouchUp(t),this.buttonDown=!1},GUIUPDATE.push(this)}checkUpdate(){this.buttonDown&&this.repeatOnTouch(this)}setStyles(t=[]){t.forEach((t=>{this._.style.setProperty(t[0],t[1])}))}set value(t){this._.textContent=t}get value(){return this._.textContent}set text(t){this._.textContent=t}get text(){return this._.textContent}positionLT(t,e){this._.style.left=t,this._.style.top=e}positionLB(t,e){this._.style.left=t,this._.style.bottom=e}positionRB(t,e){this._.style.right=t,this._.style.bottom=e}positionRT(t,e){this._.style.right=t,this._.style.top=e}size(t,e){this._.style.width=t,this._.style.height=e}scale(t,e){this._.style.padding=t+" "+e}attr(t,e){this._.style.setProperty(t,e)}remove(){this._.remove()}isVisible(t){this._.style.display=t?"block":"none"}onClick(t){}repeatOnTouch(t){}onTouchDown(t){}onTouchUp(t){}}class Button extends GUI{constructor(t="default",e=[]){super(e,"button"),this._.textContent=t}}class Canvas2D extends GUI{constructor(t="default",e=[]){super(e,"canvas"),this._.textContent=t,this.pen=this._.getContext("2d"),this.ctx=()=>this.pen,this.width=()=>this._.width,this.height=()=>this._.height,this._.style.padding="0px",this._.style.margin="0px"}}class Label extends GUI{constructor(t="default",e="h1",i=[]){super(i,e),this._.textContent=t}}class Input extends GUI{constructor(t="default",e=[]){super(e,"input"),this.placeholder=t}}class Textarea extends GUI{constructor(t="default",e=[]){super(e,"textarea"),this.placeholder=t}}class Box extends Base{constructor(t=new Vector(0,0),e=new Texture){super(),this.name="box",this.position=t,this.texture=e}}function UPDATEGUI(){GUIUPDATE.forEach((t=>{t.checkUpdate(t)})),requestAnimationFrame(UPDATEGUI)}function BLHC(){return[new Button("^",[["left","100px"],["bottom","170px"],["width","70px"],["height","70px"],["background","black"],["color","white"]]),new Button("<",[["left","30px"],["bottom","100px"],["width","70px"],["height","70px"],["background","black"],["color","white"]]),new Button(">",[["left","170px"],["bottom","100px"],["width","70px"],["height","70px"],["background","black"],["color","white"]]),new Button("âœ“",[["left","100px"],["bottom","30px"],["width","70px"],["height","70px"],["background","black"],["color","white"]])]}function BasicLeftHandController(){return BLHC()}function BRHC(){return[new Button("(-_-)",[["right","160px"],["bottom","170px"],["width","90px"],["height","90px"],["background","black"],["color","white"]]),new Button("(+_+)",[["right","30px"],["bottom","170px"],["width","90px"],["height","90px"],["background","black"],["color","white"]]),new Button("(!_!)",[["right","30px"],["bottom","30px"],["width","90px"],["height","90px"],["background","black"],["color","white"]]),new Button("(=_=)",[["right","160px"],["bottom","30px"],["width","90px"],["height","90px"],["background","black"],["color","white"]])]}function BasicRightHandController(){return BLHC()}UPDATEGUI();class Instance{constructor(t){this.game=t,this.memory={},this.entities={},this.controls={}}onCreate(){}add(t,e){this.entities[t]=e}addToMemory(t,e){this.memory[t]||(this.memory[t]=e)}fetchFromMemory(t){return this.memory[t]}clearObjectInMemory(t){delete this.memory[t]}fromMemoryToObject(t){this.memory[t]&&this.add(t,this.memory[t])}fromObjectToMemory(t){this.fetch(t)&&this.addToMemory(t,this.fetch(t))}addGUI(t,e){this.controls[t]=e}fetchGUI(t){return this.controls[t]}fetch(t){return this.entities[t]}show(){this.game.reset(),GUIUPDATE.forEach((t=>{t.isVisible(!1)})),this.onCreate(this),Object.values(this.entities).forEach((t=>{this.game.add(t)})),Object.values(this.controls).forEach((t=>{t.isVisible(!0)}))}}class Section{constructor(t){this.game=t,this.instances={}}createInstance(t,e){let i=new Instance(this.game);i.onCreate=e,this.instances[t]=i}deleteInstance(t){delete this.instances[t]}connect(t,e){this.instances[t]=e}fetchInstance(t){return this.instances[t]}showInstance(t){this.instances[t].show()}}class Asset{constructor(t){this.content=t}loadToSound(){return new Sound(this.content)}loadToImage(){return new Image(this.content)}loadToTexture(){let t=new Texture;return t.changeURL(this.content),t}}class HTMLDialog{constructor(t){this._=document.createElement("dialog"),this._.innerHTML=t,this._.style.padding="20px",this._.style.width="100%",this._.style.height="100vh",this._.style.boxShadow="0 0 15px black",document.body.appendChild(this._)}setBackground(t){this._.style.background=t}setBackgroundTexture(t){this._.style.background=`url(${text.getImage().src})`}show(){this._.showModal()}close(){this._.close()}get html(){return this._.innerHTML}set html(t){this._.innerHTML=t}}class Gravity extends Base{constructor(t,e=[],i=new Vector(0,1),s=[]){super(),this.ref=t,this.__entities__=e,this.__value__=i,this.fer=s}add(t){this.__entities__.push(t)}_(){return this.__entities__}draw(t){this.__entities__.forEach((t=>{t.collideWith(this.ref)||t.position.add(canMoveArray(t,this.fer,scale(this.__value__,t.mass)))}))}setValue(t){this.__value__=t}}class TEXTDialog{constructor(t="Default",e="Tahoma",i="30px"){this._=document.createElement("dialog"),this._.innerHTML=t+"<br><h6>(click to continue) </h6>",this._.style.padding="20px",this._.style.outline="none",this._.style.border="none",this._.style.textAlign="center",this._.style.background="transparent",this._.style.font=e,this._.style.fontSize=i,this._.style.width=String(window.innerWidth)+"px",document.body.appendChild(this._),window.addEventListener("click",(()=>{this.close()}))}setBackground(t){this._.style.background=t}setBackgroundTexture(t){this._.style.background=`url(${text.getImage().src})`}show(){this._.showModal()}close(){this._.close()}get html(){return this._.innerHTML}set html(t){this._.innerHTML=t}}function speak(t,e=1,i=1,s=1){if("speechSynthesis"in window){const o=new SpeechSynthesisUtterance(t);o.pitch=e,o.rate=i,o.volume=s,window.speechSynthesis.speak(o)}else alert(t)}const Tools={randomNumber:(t,e)=>getRandomInt(t,e),randomChoice:t=>t[getRandomInt(0,t.length-1)],toRadians:t=>toRad(t),toDegrees:t=>t/Math.PI*180,nullVector:()=>new Vector,getWorldDirection:(t="north")=>"north"===t?new Vector(0,-1):"south"===t?new Vector(0,1):new Vector("west"===t?-1:"east"===t?1:0,0),texture(t,e,i){d=new Texture,d.fillWithColor(t,e,i)},toImage(t){let e=new Image;return e.src=t,e},toSrc:t=>t.src,setRotation(t,e,i){t.settings.rotationType=e,t.rotation=i},findEntityByName(t){game.entities.forEach((e=>{if(e.name==t)return e}))},findEntitiesByName:t=>(en=[],game.entities.forEach((e=>{e.name==t&&en.push(e)})),en),setVelocity(t,e,i,s){t.velocity=e,t.settings.velocityReduction=i,t.settings.velocitySensitivity=s},root:t=>t._,bind:{speed:2},bindButtons(t,e,i=!0,s=!0){i&&(e[0].repeatOnTouch=()=>{t.position.add(t.getDirection("north").scale(Tools.bind.speed))}),e[1].repeatOnTouch=()=>{t.position.add(t.getDirection("west").scale(Tools.bind.speed))},e[2].repeatOnTouch=()=>{t.position.add(t.getDirection("east").scale(Tools.bind.speed))},s&&(e[3].repeatOnTouch=()=>{t.position.add(scale(t.getDirection("south"),Tools.bind.speed))})}},Emitter={_:{},add(t){Emitter._[t]||(Emitter._[t]=[])},on(t,e){Emitter._[t]?Emitter._[t].push(e):console.warn(`Event "${t}" is not registered. Please call add("${t}") first.`)},remove(t){delete Emitter._[t]},off(t,e){Emitter._[t]?Emitter._[t]=Emitter._[t].filter((t=>t!==e)):console.warn(`Event "${t}" is not registered. Cannot remove listener.`)},emit(t,e){Emitter._[t]?Emitter._[t].forEach((t=>{t(...e)})):console.warn(`Event "${t}" is not registered. Cannot call listeners.`)}};class Thread{constructor(t=""){this.content=t,this.worker=null,this.config={JSON:!0}}loadFromScript(t){this.content=document.getElementById(t).textContent}loadFromText(t){this.content=t}run(){let t=URL.createObjectURL(new Blob([this.content],{type:"application/javascript"}));this.worker=new Worker(t),this.worker.onmessage=e=>{this.onMessage(e),URL.revokeObjectURL(t)},this.worker.onerror=e=>{this.onError(e),URL.revokeObjectURL(t)},t=null}send(t,e=!1){e?this.worker&&this.worker.postMessage(JSON.stringify(t)):this.worker&&this.worker.postMessage(t)}onError(){}terminate(){this.worker.terminate(),this.worker=null}onMessage(t){}}const Threads={_:{},create(t){Threads._[t]=new Thread},fetch:t=>Threads._[t],isOk:()=>Object.value(Threads._).length<navigator.hardwareConcurency,remove(t){Threads._[t].terminate(),delete Threads._[t]},script:t=>t.replace("<e>","self.onmessage = function(e) {").replace("</e>","};").replace("<-$->","const $parse=(tag)=>JSON.parse(tag),$string=(tag)=>JSON.stringify(tag),$post=(tag)=>self.postMessage(tag),$out=(s)=>$post($string(s));").replace("<-v->","\n      const vec2=(x=0,y=0)=>{x,y},\n      add=(a,b)=>vec2(a.x+b.x,a.y+b.y),\n      subtract=(a,b)=>vec2(a.x-b.x,a.y-b.y),\n      multiply=(a,b)=>vec2(a.x*b.x,a.y*b.y),\n      divide=(a,b)=>vec2(a.x/b.x,a.y/b.y),\n      invert=(a)=>vec2(1/a.x,1/a.y),\n      dot=(a, b)=>{\n      return a.x * b.x + a.y * b.y;\n      },\n      negate=(a)=>vec2(-a.x,-a.y),\n      sqrt=(...z)=>Math.sqrt(...z),\n      min=(...z)=>Math.min(...z),\n      max=(...z)=>Math.max(...z),\n      sqr=(x)=>x*x,\n      cos=(...z)=>Math.cos(...z),\n      sin=(...z)=>Math.sin(...z),\n      tan=(...z)=>Math.tan(...z),\n      normalize=(a)=>{\n      let u=Math.sqrt(a.x*a.x+b.x*b.x)\n      return vec2(a.x/u,a.y/u)\n      },\n      lerp=(a,b,d)=>{\n      vec2(\n      a.x+d*(b.x-a.x),\n      a.y+d*(b.y-a.y)\n      )\n      },\n      vectodict=(v)=>{\n      return {x:v.x,y:v.y}\n      },\n      dicttovec=(v)=>{\n      vec2(v.x,v.y)\n      }\n      ")},vec2=(t=0,e=0)=>new Vector(t,e),add=(t,e)=>vec2(t.x+e.x,t.y+e.y),subtract=(t,e)=>vec2(t.x-e.x,t.y-e.y),multiply=(t,e)=>vec2(t.x*e.x,t.y*e.y),scale=(t,e)=>vec2(t.x*e,t.y*e),divide=(t,e)=>vec2(t.x/e.x,t.y/e.y),invert=t=>vec2(1/t.x,1/t.y),dot=(t,e)=>t.x*e.x+t.y*e.y,negate=t=>vec2(-t.x,-t.y),sqrt=(...t)=>Math.sqrt(...t),min=(...t)=>Math.min(...t),max=(...t)=>Math.max(...t),sqr=t=>t*t,cos=(...t)=>Math.cos(...t),sin=(...t)=>Math.sin(...t),tan=(...t)=>Math.tan(...t),normalize=t=>{let e=Math.sqrt(t.x*t.x+t.y*t.y);return vec2(t.x/e,t.y/e)},lerp=(t,e,i)=>{vec2(t.x+i*(e.x-t.x),t.y+i*(e.y-t.y))},vectodict=t=>({x:t.x,y:t.y}),dicttovec=t=>{vec2(t.x,t.y)},Clock={_:[],register_once(t,e=1){const i=setInterval((e=>{t(e),clearInterval(i)}),e)},register_interval:(t,e=1)=>setInterval((e=>{t(e)}),e),remove_interval(t){clearInterval(t)},register_loop(t){Clock._.push(t)},remove_loop(t){Clock._.forEach(((e,i)=>{e==t&&Clock._.splice(i,1)}))},update:t=>{Clock._.forEach((e=>{e(t)})),requestAnimationFrame(Clock.update)}};requestAnimationFrame(Clock.update);const Entity=({texture:t=new Texture,position:e=vec2(),rotation:i=0,color:s="red",imgSrc:o=!1,imgSize:n=[100,100],uImg:h=!0,outline:a=!1,force:r=vec2(),moveWith:l=vec2()}={})=>{let c=new Box(e,t);return c.rotation=i,o?c.texture.changeURL(o):c.texture.fillWithColor(s),h&&(c.texture.image.onload=()=>{c.texture.resize(...n)}),c.applyForce(r),c.moveWith=l,c.settings.hasOutline=!!a,c.settings.outlineColor=a,c},Ground=(t,e="lightgreen",i)=>{let s=new Texture;s.fillWithColor(e,t.width,i);let o=new Box(vec2(0,t.height-i),s);return o.createGravity=(t=[],e=[],i=vec2(0,1))=>{o.data.gravity=new Gravity(o,t,i,e)},o.addGravity=t=>{t.add(o.data.gravity)},o.setGravity=(t=vec2())=>{o.data.gravity.setValue(t)},o.gravity=()=>o.data.gravity,o};class TileGravity extends Base{constructor({refrences:t=[],entities:e=[],velocity:i=vec2(0,1)}={}){super(),this.p=t,this.t=e,this.g=i}set velocity(t){this.g=t}get velocity(){return this.g}draw(t){this.t.forEach((t=>{let e=!0;this.p.forEach((i=>{i.collideWith(t)&&(e=!1)})),e&&t.position.add(scale(this.g,t.mass))}))}setValue(t){this.__value__=t}}const Buttons={attrs(t,e,i){i.forEach((i=>{i._.style.setProperty(t,e)}))},attr(t,e,i){i._.style.setProperty(t,e)},disable(t,e){t.forEach((t=>{e[t].isVisible(!1)}))},enable(t,e){t.forEach((t=>{e[t].isVisible(!0)}))}},GUIs=Buttons;class Stream{constructor(t={binary:!1,data:[]}){this.data=t.data||[],this.b=t.binary??!1,this.il=0}onPush(){}onConfirm(t){return!0}chunk(t){return this.data[t]}push(t){return!!this.onConfirm(t,this.il)&&(this.onPush(t,this.il),this.data[this.il]=t,this.il+=1,!0)}toIndex(t,e){return!!this.onConfirm(t,e)&&(this.onPush(t,e),this.data[e]=t,this.il+=1,!0)}forEach(t){for(let e=0;e<this.data.length;e++)t(this.data[e],e)}concat(t=" , "){return this.data.join(t)}splice(t,e=!1){let i=new Stream({binary:e}),s=new Stream({binary:e});for(let e=0;e<t;e++)i.push(this.data[e]);for(let e=t;e<this.data.length;e++)s.push(this.data[e]);return[i,s]}}class Writer{constructor(t={key:"default1234",config:"local"}){this.key=t.key||"default1234",this.type=t.config||"local",this.LOCALSTORAGE="local",this.SESSIONSTORAGE="session",this.INDEXDB="index",this._={},this._.delete=t=>{delete this._[t]},this._.add=(t,e)=>{this._[t]=e}}onEdit(){}onRead(){}config(t){this.type=t}get pen(){return this.onRead(this._),this._}set pen(t){this.onEdit(this._,t),this._=t}store(t=!0){let e=t?JSON.stringify(this._):this._;this.type==this.LOCALSTORAGE?localStorage.setItem(this.key,e):this.type==this.SESSIONSTORAGE&&sessionStorage.setItem(this.key,e)}recover(t=!0){let e="";return this.type==this.LOCALSTORAGE?e=localStorage.getItem(this.key):this.type==this.SESSIONSTORAGE&&(e=sessionStorage.getItem(this.key)),this._=t?JSON.parse(e):e,this._}}class SubProcess{constructor(t=[],e=null,i=null,s=!1){this.beg=e,this.loop=i,this.args=t,this.data={},this.id=26,this.die=s,this.count=0}updateCount(){this.count+=1,this.die&&this.count>this.die&&this.terminate()}onStart(){}run(t=2){this.beg(...this.args),this.onStart(...this.args),this.update(),this.delay=t}update(){if(this.updateCount(),this.count%this.delay==0)try{this.loop(...this.args)}catch{}requestAnimationFrame((()=>this.update()))}pause(){clearInterval(this.loop)}terminate(){clearInterval(this.loop),this.beg=null,this.loop=null,this.args=null}config(t=[],e=null,i=null){this.beg=e,this.loop=i,this.args=t}}const Process={_:{},create(t="17887"){t=String(t);let e=new SubProcess;return e.id=t,Process._[t]=e,Process._[t]},config(t,...e){t.config(...e)},terminate(t){Process._[t].terminate()},get pool(){return Process._},set pool(t){Process._=t}},Particles=({position:t=vec2(),width:e=200,height:i=200,count:s=100,size:o=1,color:n="blue"}={})=>new ParticleSystem(t,vec2(e,i),o,s,n);Tools.getBox=t=>({x:t.position.x||null,y:t.position.y||null,width:t.width||null,height:t.height||null}),Tools.EntityToJson=t=>({position:{x:t.position.x,y:t.position.y},rotation:t.rotation,textureURL:t.texture.image.src,settings:t.settings});const ETJ=t=>Tools.EntityToJson(t),RAD=t=>Tools.toRadians(t),DEG=t=>Tools.toDegrees(t),IMG=t=>{let e=new Image;return e.src=t,e},TSRC=t=>t.image.src,JTE=t=>Entity({imgSrc:t.textureURL,position:vec2(t.position.x,t.position.y),rotation:t.rotation,settings:t.settings,uImg:!1}),RND=(...t)=>Tools.randomNumber(...t),CHS=(...t)=>Tools.randomChoice(...t),CPY=(t,e={})=>{let i=ETJ(t);return Object.keys(e).forEach((t=>{i[t]=e[t]})),Entity({imgSrc:(s=i).textureURL,position:vec2(s.position.x,s.position.y),rotation:s.rotation,settings:s.settings,uImg:!1});var s},TCOL=(t="lightgreen",e=100,i=100)=>{let s=new Texture;return s.fillWithColor(t,e,i),s},COL=(t="lightgreen",e=100,i=100)=>{let s=new Texture;return s.fillWithColor(t,e,i),s.image},BaseStore=({key:t="default1234",data:e={},type:i="local"}={})=>{"local"==i?Object.keys(e).forEach((t=>{!localStorage.getItem(t)&&localStorage.setItem(t,e[t])})):"session"==i&&Object.keys(e).forEach((t=>{!sessionStorage.getItem(t)&&sessionStorage.setItem(t,e[t])}))};class MassController{constructor(t=[]){this._=t}get beforeRender(){return()=>{}}set beforeRender(t){this._.forEach((e=>{e.beforeRender=t}))}allToGame(t){this._.forEach((e=>{t.add(e)}))}execAll(t){this._.forEach((e=>t(e)))}exec(t=[],e){t.forEach((t=>e(this._[t])))}someToGame(t,e){t.forEach((t=>{e.add(this._[t])}))}entities(){return this._}}const AABBCheckCollide=(t,e)=>t.position.x+t.width>e.position.x&&t.position.x<e.position.x+e.width&&t.position.y+t.height>e.position.y&&t.position.y<e.position.y+e.height,RIGID=[],RIGIDPROCESS=new SubProcess([RIGID],(()=>{}),(t=>{t.forEach(((e,i)=>{t.forEach(((t,s)=>{if(i!==s&&AABBCheckCollide(e,t)&&(e.onCollide(e,t),e.settings.rigidResult)){let i=vec2();i.add(scale(add(e.velocity,e.moveWith),e.mass*e.settings.rigidElasticity)).subtract(scale(add(t.velocity,t.moveWith),t.mass*t.settings.rigidElasticity)),e.settings.rigidElastic?(e.moveWith=vec2(i.x,i.y),e.velocity=vec2()):(e.velocity=vec2(i.x,i.y),e.moveWith=vec2()),e.velocity.negate(),e.moveWith.negate()}})),e.data.rigidConfigRem&&(t.splice(i,1),delete e.data.rigidConfigRem)}))}));RIGIDPROCESS.start=(t=2)=>{RIGIDPROCESS.run(t)},RIGIDPROCESS.add=t=>{RIGID.push(t)},RIGIDPROCESS.remove=t=>{t.data.rigidConfigRem=!0};const RGD=RIGIDPROCESS,cloneProcessARGS=(t,e=null,i=(()=>{}),s=(()=>{}))=>[t.args,t.beg,t.loop],limitEntity=(t,e=100,i=0,s=100,o=0,n=!1)=>{t.position.x-t.width<i?t.position.x=n?i:e-1:t.position.x>e?t.position.x=n?e-1:i+1:t.position.y-t.height<o?t.position.y=n?o:s-1:t.position.y>s&&(t.position.y=n?s-1:o+1)};class BoxCollider extends Base{constructor(t,e=0,i=0,s=0,o=0){super(),this.parent=t,this.position=vec2(),this.width=0,this.height=0,this.isVisible=!0,this.offset={x:e,y:i,w:s,h:o},this.color="green"}beforeRender(){}toggle(){this.isVisible=!this.isVisible}collideWith(t){return AABBCheckCollide(this,t)}setParent(t){this.parent=t}draw(t){this.parent&&(this.position=add(this.parent.position,vec2(this.offset.x,this.offset.y)),this.width=this.parent.width+this.offset.width,this.height=this.parent.height+this.offset.height),this.isVisible&&(t.strokeStyle=this.color,t.strokeRect(this.position.x,this.position.y,this.width,this.height))}}const negativeX=t=>Math.sign(t.x)<0,negativeY=t=>Math.sign(t.y)<0,entityBorder=(t,e=[],i=vec2())=>{e.forEach((e=>{AABBCheckCollide(t,e)}))},KEYMAP={},KeyReg={register(t){Emitter.add("on-key-down"),Emitter.add("on-key-up"),Emitter.add("on-key-repeat"),t.onkeydown=t=>{KEYMAP[t.key]=!0,Emitter.emit("on-key-down",[t.key])},t.onkeyup=t=>{KEYMAP[t.key]=!1,Emitter.emit("on-key-up",[t.key])}}};Clock.register_loop((()=>{Object.keys(KEYMAP).forEach((t=>{KEYMAP[t]&&Emitter.emit("on-key-repeat",[t])}))}));const canMove=(t=Entity(),e=Entity(),i=vec2(),s=((t,e)=>AABBCheckCollide(t,e)))=>{let o=vec2(i.x,i.y);return s(t,e)&&(e.position.x>t.position.x?negativeX(o)||(o.x=0):negativeX(o)&&(o.x=0),e.position.y>t.position.y?negativeY(o)||(o.y=0):negativeY(o)&&(o.y=0)),o},canMoveArray=(t=Entity(),e=[],i=vec2(),s=((t,e)=>AABBCheckCollide(t,e)))=>{let o=vec2(i.x,i.y);return e.forEach((e=>{s(t,e)&&(e.position.x>t.position.x?negativeX(o)||(o.x=0):negativeX(o)&&(o.x=0),e.position.y>t.position.y?negativeY(o)||(o.y=0):negativeY(o)&&(o.y=0))})),o};